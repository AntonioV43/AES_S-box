<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AES-128 Custom S-box (Affine Matrix)</title>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 40px;
}
h2, h3, h4 {
    margin-top: 30px;
}
select, input, button {
    padding: 8px;
    margin-top: 8px;
    width: 420px;
}
button {
    width: 420px;
}
table {
    border-collapse: collapse;
    margin-bottom: 15px;
}
td, th {
    border: 1px solid #333;
    padding: 6px;
    text-align: center;
    font-family: monospace;
}
th {
    background-color: #eee;
}
pre {
    background: #f4f4f4;
    padding: 15px;
    font-family: monospace;
}
.notice {
    background: #fff3cd;
    border: 1px solid #ffeeba;
    padding: 12px;
    margin-bottom: 20px;
    font-size: 14px;
}
hr {
    margin: 40px 0;
}
</style>
</head>

<body>

<h2>AES-128 Custom S-box Using Affine Matrix</h2>

<form method="post">
    <label><b>Affine Matrix</b></label><br>
    <select name="matrix" required>
        {% for k in matrices %}
            <option value="{{ k }}">{{ k }}</option>
        {% endfor %}
    </select><br><br>

    <label><b>Plaintext</b></label><br>
    <input type="text" name="plaintext" placeholder="Enter plaintext" required><br><br>

    <button type="submit">Generate, Encrypt & Decrypt</button>
</form>

{% if result %}
<hr>
<h3>Result</h3>

<div class="notice">
<b>Note:</b><br>
Some internal AES states may contain non-printable (illegal) characters.
These characters are <b>automatically ignored during Excel export</b> to ensure
file compatibility and prevent export errors.
</div>

<pre>
AES Key Generated (HEX):
{{ result.Key }}

Plaintext:
{{ result.Plaintext }}

Ciphertext (HEX):
{{ result.Ciphertext }}

Decrypted Plaintext:
{{ result.Decrypted }}

Nonlinearity (NL)                : {{ result.NL }}
Strict Avalanche (SAC)           : {{ result.SAC }}
BIC – Nonlinearity (BIC_NL)      : {{ result.BIC_NL }}
BIC – Strict Avalanche (BIC_SAC) : {{ result.BIC_SAC }}
Linear Approximation (LAP)       : {{ result.LAP }}
Differential Approximation (DAP) : {{ result.DAP }}
Differential Uniformity (DU)     : {{ result.DU }}
Algebraic Degree (AD)            : {{ result.AD }}
Transparency Order (TO)          : {{ result.TO }}
Correlation Immunity (CI)        : {{ result.CI }}
</pre>

<a href="/download">
    <button style="margin-bottom:20px;">
        ⬇ Download Result (Excel)
    </button>
</a>

{% endif %}

{% if sbox_table %}
<hr>
<h3>Generated S-box</h3>
<table>
<tr>
    <th></th>
    {% for i in range(16) %}<th>{{ "%X"|format(i) }}</th>{% endfor %}
</tr>
{% for r in range(16) %}
<tr>
    <th>{{ "%X"|format(r) }}</th>
    {% for c in range(16) %}<td>{{ sbox_table[r][c] }}</td>{% endfor %}
</tr>
{% endfor %}
</table>
{% endif %}

{% if enc_trace %}
<hr>
<h3>AES Encryption Trace (Round 0 – 10)</h3>
{% for r in enc_trace %}
<h4>Round {{ r.round }}</h4>
{% for step, state in r.items() if step != "round" %}
<b>{{ step }}</b>
<table>
{% for row in state %}
<tr>{% for v in row %}<td>{{ v }}</td>{% endfor %}</tr>
{% endfor %}
</table>
{% endfor %}
{% endfor %}
{% endif %}

{% if dec_trace %}
<hr>
<h3>AES Decryption Trace (Round 10 – 0)</h3>
{% for r in dec_trace %}
<h4>Round {{ r.round }}</h4>
{% for step, state in r.items() if step != "round" %}
<b>{{ step }}</b>
<table>
{% for row in state %}
<tr>{% for v in row %}<td>{{ v }}</td>{% endfor %}</tr>
{% endfor %}
</table>
{% endfor %}
{% endfor %}
{% endif %}

</body>
</html>
